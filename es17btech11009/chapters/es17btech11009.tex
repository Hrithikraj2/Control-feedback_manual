Consider the quadrature-oscillator circuit given Fig. \ref{fig:es17btech11009_fig1} without the limiter. Let the resistance $R_{f}$ be equal to $\frac{2R}{1 + \Delta}$ where $\Delta << 1$. Show that the poles of the characteristic equation are in the right-half s plane and given by 
s $\approx \frac{1}{CR}(\frac{\Delta}{4}\pm j)$

\numberwithin{equation}{enumi}
\begin{figure}[!ht]
\begin{center}
\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_fig1.tex}}
\end{center}
\caption{}
\label{fig:es17btech11009_fig1}
\end{figure}
%\begin{enumerate}[label=\thesubsection.\arabic*.,ref=\thesubsection.\theenumi]

\begin{enumerate}[label=\arabic*.,ref=\theenumi]
\item Identify the the open loop gain and feedback  components of the circuit.
\\
\solution See Fig. \ref{fig:es17btech11009_b4}.
%\ref{fig:es17btech11009_fig2}.
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_block4.tex}}
	\end{center}
\caption{Circuit without the limiter}
\label{fig:es17btech11009_b4}
\end{figure}
\numberwithin{figure}{enumi}
\item Draw the block diagram and equivalent circuit for $H$.
\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_block3.tex}}
	\end{center}
\caption{Feedback Block diagram}
\label{fig:es17btech11009_b3}
\end{figure}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_fig3.tex}}
	\end{center}
\caption{Equivalent Feedback Circuit}
\label{fig:es17btech11009_fig3}
\end{figure}
\renewcommand{\thefigure}{\theenumi}
\\
\solution See Figs. \ref{fig:es17btech11009_b3} and \ref{fig:es17btech11009_fig3}.
\begin{align}
    H = \frac{v_{f}}{v_{o}}
\end{align}
\item Find $H$.
\\
\solution In \ref{fig:es17btech11009_fig3},
%Use voltage division principle to write the expression of the fraction of its input voltage.
\begin{align}
v_{+}&= v_{-}=\brak{\frac{v_{o_2}}{2R + 2R}}\brak{2R} = \frac{v_{o_2}}{2}
\end{align}
%
Using node analysis at the non- inverting terminal, and substituting 
%of the op amp in Fig \ref{fig:es17btech11009_fig3}
\begin{align}
R_{f} &= \frac{2R}{1 + \Delta},
\label{eq:es17btech11009_Rf}
\end{align}
%\\
\begin{align}
\frac{\frac{v_{0_2}}{2} - v_{o_1}}{2R} + \frac{\frac{v_{0_2}}{2}}{\frac{1}{sC}} + \frac{\frac{v_{0_2}}{2} - v_{o_2}}{R_{f}} &=0
\\
%\end{align}
%\begin{align}
%\frac{v_{o_2} - 2v_{o_1}}{4R} + sC\frac{v_{o_2}}{2} + \frac{v_{o_2} - 2v_{o_2}}{2R_{f}} = 0
%\end{align}
%\begin{align}
%\frac{v_{o_2} - 2v_{o_1}}{4R} + sCv_{o_2} -  \frac{v_{o_2}}{R_{f}} = 0
%\end{align}
%Substitute $R_{f} = \frac{2R}{1 + \Delta}$ and find the feedback factor H
%\begin{align}
\implies \frac{v_{o_2} - 2v_{o_1}}{4R} + sCv_{o_2} -  \frac{v_{o_2}}{2R}\brak{1 + \Delta} &= 0
\end{align}
%\begin{align}
%v_{o_2}\brak{\frac{1}{2R} + sC - \frac{1+ \Delta}{2R}}&= \frac{v_{o_1}}{R} 
%\end{align}
%\begin{align}
%v_{o_2}\brak{1 + 2sRC -1 - \Delta}&= 2v_{o_1}
%\end{align}
%Simplifying further,
%\begin{align}
\begin{align}
\text{or, }    H = \frac{v_{o_2}}{v_{o_1}}= \frac{1}{sRC - \frac{\Delta}{2}}
    \label{eq:es17btech11009_H}
\end{align}
%\begin{align}
%    H &=\frac{v_{o_2}}{v_{o_1}}= \frac{1}{sRC - \frac{\Delta}{2}}
%    \label{eq:es17btech11009_H}
%\end{align}
after some algebra.
%\item 
%The equivalent Circuit is shown in Fig 
%\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
%
%\begin{align}
%    H = \frac{v_{o_2}}{v_{o_1}}
%\end{align}

%\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\item
And the Equivalent circuit at the input of op-amp 2 is given in Fig \ref{fig:es17btech11009_fig2}
\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_fig2.tex}}
	\end{center}
\caption{}
\label{fig:es17btech11009_fig2}
\end{figure}
\item 
\solution The voltage $v_{o_1}$ and 2R are replaced with the Norton equivalent composed of a current source $\frac{v_{o_1}}{2R}$ and parallel resistance 2R. The direction of current in $R_{f}$ would be from output to input. Thus $R_{f}$ gives rise to a negative input resistance $-R_{f}$ as indicated in equivalent circuit given in Fig \ref{fig:es17btech11009_fig2}

When we consider the circuit without the limiter and break the loop at X, The circuit looks as shown in Fig \ref{fig:es17btech11009_b4}
\renewcommand{\thefigure}{\theenumi.\arabic{figure}}

\item
Find the open loop gain.

Consider the general open loop block diagram as shown in Fig \ref{fig:es17btech11009_block1}
\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_block1.tex}}
	\end{center}
\caption{Open Loop Block diagram}
\label{fig:es17btech11009_block1}
\end{figure}
\begin{align}
    G = \frac{v_{o}}{v_{i}} 
\end{align}
\item
Find $R_{11}$ and $R_{22}$ from Fig \ref{fig:es17btech11009_R}
\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_R.tex}}
	\end{center}
\caption{From Feedback Circuit}
\label{fig:es17btech11009_R}
\end{figure}

Shorting $v_{o_1}$ to ground,
\begin{align}
    R_{11} = R_{f} + \brak{2R\parallel \frac{1}{sC}}
\end{align}
From \eqref{eq:es17btech11009_Rf},
\begin{align}
    R_{11} = \brak{\frac{2R}{1+ \Delta}} + \brak{2R \parallel \frac{1}{sC}}
\end{align}
Shorting $v_{o_2}$ to ground,
\begin{align}
    R_{22} = 2R + \brak{R_{f}\parallel \frac{1}{sC}}
\end{align}
From \eqref{eq:es17btech11009_Rf},
\begin{align}
    R_{22} =  2R + \brak{\brak{\frac{2R}{1 + \Delta}}\parallel \frac{1}{sC}}
\end{align}

\item
Equivalent circuit diagram for Fig \ref{fig:es17btech11009_block1} is shown in \ref{fig:es17btech11009_block2}
\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_block2.tex}}
	\end{center}
\caption{Equivalent Circuit for open loop block diagram}
\label{fig:es17btech11009_block2}
\end{figure}

where $G_{0}$ is the gain of the op-amp.

The expression for open loop gain is 
\begin{align}
    G = \frac{v_{o_1}}{v_{X}} = -\frac{1}{sCR}
    \label{eq:es17btech11009_G}
\end{align}

\item
Draw the equivalent control system representation for the circuit in Fig. \ref{fig:es17btech11009_b4} which is given in \ref{fig:es17btech11009_block}

\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		\resizebox{\columnwidth}{!}{\input{./figs/es17btech11009/es17btech11009_2.tex}}
	\end{center}
\caption{Simplified equivalent block diagram}
\label{fig:es17btech11009_block}
\end{figure}
\item 
 The Quadrature oscillator is based on the second integrator.

As an active filter, the loop is damped to locate the poles in the left half of the s-plane. In the quadrature oscillator, the op amp 1 is connected as an inverting miller integrator with a limiter in the feedback for controlling the amplitude. The op amp 2 is connected as a non-inverting integrator.

\item
The transfer function of the equivalent positive feedback circuit in Fig. \ref{fig:es17btech11009_fig3} is  
\begin{align}
T &= \frac{G}{1-GH}
\label{eq:es17btech11009_TF}
\end{align}
Therefore, loop gain is given by 
\begin{align}
L &= GH
\end{align}
From \eqref{eq:es17btech11009_G} and \eqref{eq:es17btech11009_H}
\begin{align}
L\brak{s}&= \frac{-1}{sCR}\frac{1}{sCR - \frac{\Delta}{2}}
\end{align}
\begin{align}
L\brak{s}&= \frac{1}{-s^2C^2R^2 + \frac{sCR\Delta}{2}}
\end{align}
Consider the characteristic equation of the transfer function \eqref{eq:es17btech11009_TF},
\begin{align}
    1 - L\brak{s} = 0
\end{align}
\begin{align}
    L\brak{s} = 1
\end{align}
\begin{align}
    -s^2C^2R^2 + \frac{sCR\Delta}{2} = 1
\end{align}
\begin{align}
    \brak{C^2R^2}s^2 + \brak{-\frac{CR\Delta}{2}}s + 1 = 0
\end{align}
\item
Write the expression for roots of a general quadratic equation
\begin{align}
    s_{p} = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}
    \label{eq:es17btech11009_quad}
\end{align}
 Substitute $a=C^2R^2$, $b=-\frac{CR\Delta}{2}$, $c=1$ in \eqref{eq:es17btech11009_quad},
 \begin{align}
     s_{p} = \frac{-\brak{-\frac{CR\Delta}{2}} \pm \sqrt{\brak{-\frac{CR\Delta}{2}}^2 - 4\brak{C^2R^2}\brak{1}}}{2C^2R^2}
 \end{align}
 \begin{align}
      = \frac{RC\brak{\frac{\Delta}{2} \pm \sqrt{\brak{\frac{\Delta}{2}}^2 -4}}}{2C^2R^2}
 \end{align}
 \begin{align}
      = \frac{\frac{\Delta}{2} \pm \sqrt{\brak{\frac{\Delta}{2}}^2-4}}{2RC}
 \end{align}
 \begin{align}
      = \frac{\frac{\Delta}{2} \pm 2j\sqrt{1 - \brak{\frac{\Delta}{4}}^2}}{2RC}
 \end{align}
 As $\Delta << 1$, 
 \begin{align}
     \brak{1-\brak{\frac{\Delta}{4}}^2}^\frac{1}{2} = 1 - \frac{1}{2}\brak{\frac{\Delta}{4}}^2
 \end{align}
 \begin{align}
 s_{p} = \frac{\frac{\Delta}{2} \pm 2j\brak{1 - \frac{1}{2}\brak{\frac{\Delta}{4}}^2}}{2RC}
 \end{align}
 \begin{align}
  s_{p}= \frac{\frac{\Delta}{2} \pm j\brak{2 - \brak{\frac{\Delta}{4}}^2}}{2RC}
  \label{eq:es17btech11009_eqn}
 \end{align}
 From \eqref{eq:es17btech11009_eqn},
 \begin{align}
     Re\brak{s_{p}} > 0
 \end{align}
 Hence, the poles of the characteristic equation are in the right half of the s plane.
 As $\Delta << 1$, higher order terms are neglected.
 \begin{align}
     s_{p} = \frac{\frac{\Delta}{2} \pm 2j}{2RC}
 \end{align}
 \begin{align}
     s_{p} = \frac{\frac{\Delta}{4} \pm j}{RC}
 \end{align}
 
\item 
Find the frequency for arbitrary R,C values as given in Table \ref{table:es17btech11009_Table1}
\begin{table}[!ht]
\centering
\input{./tables/es17btech11009/es17btech11009_table1.tex}
\caption{}
\label{table:es17btech11009_Table1}
\end{table}

The loop will oscillate at frequency $\omega_{o}$, given by
\begin{align}
    \omega_{o} = \frac{1}{RC}
\end{align}
From Table \ref{table:es17btech11009_Table1},
\begin{align}
    \omega_{o} = 100 rad/s
\end{align}
\begin{align}
    f = \frac{\omega_{o}}{2\pi} = 15.923 Hz
\end{align}

From \eqref{eq:es17btech11009_TF},
\begin{align}
    T = \frac{-SCR + \frac{\Delta}{2}}{s^2C^2R^2 - \frac{sCR\Delta}{2} + 1}
\end{align}
From Table \ref{table:es17btech11009_Table1},
\begin{align}
    T = \frac{-0.05s + 0.05}{0.0025s^2 - 0.0025s +1}
\end{align}
The following code plots the step response of the system as shown in \ref{fig:es17btech11009_1_1}
\begin{lstlisting}
codes/es17btech11009/es17btech11009_1_1.py
\end{lstlisting}
\begin{figure}[!ht]
\centering
\includegraphics[width=\columnwidth]{./figs/es17btech11009/es17btech11009_1_1.eps}
\caption{}
\label{fig:es17btech11009_1_1}
\end{figure}
\item
The following code plots the impulse response of the system as shown in \ref{fig:es17btech11009_imp}
\begin{lstlisting}
codes/es17btech11009/es17btech11009_imp.py
\end{lstlisting}
\begin{figure}[!ht]
\centering
\includegraphics[width=\columnwidth]{./figs/es17btech11009/es17btech11009_imp.eps}
\caption{}
\label{fig:es17btech11009_imp}
\end{figure}

\item
Simulate the circuit Fig \ref{fig:es17btech11009_fig3} using spice simulators and plot the generated output using python script.

Find the netlist for the simulated circuit here:
\begin{lstlisting}
codes/es17btech11009/spice/es17btech11009.net
\end{lstlisting}
Python code used for generating the output:
\begin{lstlisting}
codes/es17btech11009/es17btech11009_spice.py
\end{lstlisting}
\begin{figure}[!ht]
\centering
\includegraphics[width=\columnwidth]{./figs/es17btech11009/es17btech11009_spice.eps}
\caption{}
\label{fig:es17btech11009_spice}
\end{figure}
\item
Consider part of the spice simulation and the following code plots the part of the output as shown in Fig \ref{fig:es17btech11009_spice1}
\begin{lstlisting}
codes/es17btech11009/es17btech11009_spice1.py
\end{lstlisting}
\begin{figure}[!ht]
\centering
\includegraphics[width=\columnwidth]{./figs/es17btech11009/es17btech11009_spice1.eps}
\caption{}
\label{fig:es17btech11009_spice1}
\end{figure}
From the Fig \ref{fig:es17btech11009_spice1},
Time period of oscillation 
\begin{align}
    T = 3.3801 - 3.317
\end{align}
\begin{align}
    f = \frac{1}{T} = 15.847 Hz
\end{align}
\begin{align}
    \omega_{o} = 2\pi f = 99.5 rad/s
\end{align}
Hence the frequency calculated from the formulae and the plot are approximately same.
\end{enumerate}
